{% extends "base.html" %}
{% block content %}
<h2>Tasks</h2>

<div id="notifications">
    {% for task in overdue_tasks %}
        <div style="background-color: #ffcccc; color: red; padding: 10px; margin-bottom: 10px; border: 1px solid red;">
            <strong>Overdue Task:</strong> {{ task.name }} (Due: {{ task.due_date }})
        </div>
    {% endfor %}
    {% for task in upcoming_tasks %}
        <div style="background-color: #ccffcc; color: green; padding: 10px; margin-bottom: 10px; border: 1px solid green;">
            <strong>Upcoming Task:</strong> {{ task.name }} (Due: {{ task.due_date }})
        </div>
    {% endfor %}
</div>


<!-- Add Task Form -->
<form method="POST" action="{{ url_for('add_task') }}">
    <input type="text" name="name" placeholder="Task Name" required>
    <select name="category" required>
        <option value="" disabled selected>Select Category</option>
        {% for cat in categories %}
            <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}
    </select>
    <select name="priority" required>
        <option value="" disabled selected>Select Priority</option>
        {% for pri in priorities %}
            <option value="{{ pri }}">{{ pri }}</option>
        {% endfor %}
    </select>
    <input type="date" name="due_date">
    <button type="submit">Add Task</button>
</form>

<!-- Search Bar -->
<form method="GET" action="{{ url_for('tasks') }}" style="margin-top: 20px;">
    <input
        type="text"
        name="search"
        placeholder="Task Searcher"
        value="{{ request.args.get('search', '') }}"
        style="width: 100%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;"
    >
    <button type="submit" style="display: none;"></button>
</form>

<!-- Filter and Sort Form -->
<form method="GET" action="{{ url_for('tasks') }}">
    <label for="sort_by">Sort By:</label>
    <select name="sort_by" id="sort_by">
        <option value="" disabled selected>Select an option</option>
        <option value="due_date" {% if request.args.get('sort_by') == 'due_date' %}selected{% endif %}>Due Date</option>
        <option value="priority" {% if request.args.get('sort_by') == 'priority' %}selected{% endif %}>Priority</option>
        <option value="completed" {% if request.args.get('sort_by') == 'completed' %}selected{% endif %}>Completion Status</option>
    </select>

    <label for="category">Filter by Category:</label>
    <select name="category" id="category">
        <option value="" selected>All Categories</option>
        {% for cat in categories %}
            <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
    </select>
    <button type="submit">Apply</button>
</form>

<!-- Task List -->
<h3>Your Tasks</h3>
<ul>
    {% for task in tasks %}
        <li style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
            <strong>Name:</strong> {{ task.name }}<br>
            <strong>Category:</strong> {{ task.category }}<br>
            <strong>Priority:</strong> {{ task.priority }}<br>
            <strong>Due Date:</strong> {{ task.due_date or 'No due date' }}<br>
            <strong>Status:</strong>
            {% if task.completed %}
                <span style="color: green;">Completed</span>
            {% else %}
                <span style="color: red;">Incomplete</span>
            {% endif %}
            <br>
            <!-- Toggle and Delete Buttons -->
            <form method="POST" action="{{ url_for('update_task', task_id=task.id) }}" style="display: inline;">
                <button type="submit">Toggle</button>
            </form>
            <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}" style="display: inline;">
                <button type="submit">Delete</button>
            </form>

            <!-- Comment Button -->
            <form action="{{ url_for('task_details', task_id=task.id) }}" method="GET" style="margin-top: 10px;">
                <button type="submit" style="padding: 5px 10px; cursor: pointer;">
                    Comments
                </button>
            </form>
        </li>
    {% endfor %}
</ul>
{% endblock %}



