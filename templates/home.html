{% extends "base.html" %}
{% block content %}
    <h2>Welcome, {{ current_user.username }}!</h2>

    <!-- Progress Tracking -->
    <h3>Progress Overview</h3>
    <p>Tasks Completed: {{ completed_tasks }} / {{ total_tasks }}</p>
    <p>Tasks This Week: {{ completed_week_tasks }} / {{ total_week_tasks }}</p>

    <!-- Progress Bar -->
    <div style="width: 100%; background-color: #ddd; border-radius: 5px; margin: 10px 0;">
        <div style="width: {{ progress }}%; background-color: #4caf50; color: white; text-align: center;
                    padding: 5px 0; border-radius: 5px;">
            {{ progress }}%
        </div>
    </div>

    <!-- Add Task Form -->
    <form method="POST" action="{{ url_for('add_task') }}">
        <input type="text" name="name" placeholder="Task Name" required>
        <select name="category" required>
            <option value="" disabled selected>Select Category</option>
            {% for cat in categories %}
                <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
        </select>
        <select name="priority" required>
            <option value="" disabled selected>Select Priority</option>
            {% for pri in priorities %}
                <option value="{{ pri }}">{{ pri }}</option>
            {% endfor %}
        </select>
        <input type="date" name="due_date">
        <button type="submit">Add Task</button>
    </form>

    <!-- Filter Form -->
    <form method="GET" action="{{ url_for('home') }}">
        <!-- Sorting Options -->
        <label for="sort_by">Sort By:</label>
        <select name="sort_by" id="sort_by">
            <option value="" disabled selected>Select an option</option>
            <option value="due_date" {% if request.args.get('sort_by') == 'due_date' %}selected{% endif %}>Due Date</option>
            <option value="priority" {% if request.args.get('sort_by') == 'priority' %}selected{% endif %}>Priority</option>
            <option value="completed" {% if request.args.get('sort_by') == 'completed' %}selected{% endif %}>Completion Status</option>
        </select>

        <!-- Filter by Category -->
        <label for="category">Filter by Category:</label>
        <select name="category" id="category">
            <option value="" selected>All Categories</option>
            {% for cat in categories %}
                <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        <button type="submit">Apply</button>
    </form>
    <hr>

<!-- Task Notifications -->
{% if tasks_due_today %}
    <h3 style="color: #ff9800;">Tasks Due Today</h3>
    <ul>
        {% for task in tasks_due_today %}
            <li>{{ task.name }} - Due Date: {{ task.due_date }}</li>
        {% endfor %}
    </ul>
{% endif %}

{% if overdue_tasks %}
    <h3 style="color: red;">Overdue Tasks</h3>
    <ul>
        {% for task in overdue_tasks %}
            <li style="color: red;">
                {{ task.name }} - Due Date: {{ task.due_date }}
            </li>
        {% endfor %}
    </ul>
{% endif %}

    <!-- Task List -->
    <ul>
    {% if tasks %}
        {% for task in tasks %}
            <li style="color:
                {% if task.completed %}green{% elif task.due_date and task.due_date < today %}red{% else %}black{% endif %};">
                <strong>Name:</strong> {{ task.name }} <br>
                <strong>Category:</strong> {{ task.category }} <br>
                <strong>Priority:</strong> {{ task.priority }} <br>
                <strong>Due Date:</strong> {{ task.due_date or 'No due date' }} <br>
                <strong>Status:</strong> {% if task.completed %}Completed{% else %}Incomplete{% endif %}
                <form method="POST" action="{{ url_for('update_task', task_id=task.id) }}" style="display:inline;">
                    <button type="submit">Toggle</button>
                </form>
                <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}" style="display:inline;">
                    <button type="submit">Delete</button>
                </form>
            </li>
        {% endfor %}
    {% else %}
        <li>No tasks available.</li>
    {% endif %}
</ul>

    <!-- Delete Account -->
    <form method="POST" action="{{ url_for('delete_account') }}">
        <button type="submit" class="btn btn-danger">Delete Account</button>
    </form>
{% endblock %}



